#!/bin/sh

# Exit the script if any command fails
set -e
trap cleanup EXIT

cleanup() {
	rm -f "$FILE_INVALID_TEST"
}

FILE_INVALID="${1:-path/to/fileA.js}"
FILE_INVALID_TEST="${FILE_INVALID%.*}.test.${FILE_INVALID##*.}"
FILE_VALID="${2:-path/to/fileB.js}"

# 1. Create backups of file A
cp "$FILE_INVALID" "$FILE_INVALID_TEST"

# 2. Run eslint --fix on the backup of file A
npx eslint --fix "$FILE_INVALID_TEST"

echo ""

# 3. Compare the (fixed) copy of file A to the backup of file B
if ! diff -q "$FILE_INVALID_TEST" "$FILE_VALID" &>/dev/null; then
	echo "\033[1;31mFAIL:\033[0m After eslint --fix, the files differ."
	diff "$FILE_INVALID_TEST" "$FILE_VALID" -y --color
	exit 1
fi

echo "\033[1;32mPASS:\033[0m $FILE_INVALID and $FILE_VALID are identical after eslint --fix."
